# AI RPG Vibe - Fantasy Adventure Game

A text-based fantasy RPG powered by **Quarkus**, **Vaadin**, and **LangChain4j AI agents**.

## üéÆ Features

- **AI-Driven Storytelling**: Dynamic narrative generated by specialized AI agents
- **Agent-Based NPCs**: Each NPC has personality, agenda, and memory of interactions
- **Autonomous Companions**: Team members act independently, speak up, and make their own combat decisions
- **D&D-Inspired Combat**: Turn-based stat-based combat with AI narration
- **Interchangeable LLM Providers**: Switch between OpenAI and Ollama (local models)
- **Clean Architecture**: Separation of domain, services, agents, and UI layers

## üèóÔ∏è Architecture

### Technology Stack

- **Backend**: Quarkus 3.17.4
- **Frontend**: Vaadin 24.5.5 (server-side UI)
- **AI Framework**: LangChain4j 0.36.2
- **Java Version**: 21
- **Build Tool**: Maven

### AI Agents

The game uses multiple specialized AI agents:

1. **WorldNarratorAgent** - Generates atmospheric world descriptions and story events
2. **CombatNarratorAgent** - Transforms combat mechanics into exciting narrative
3. **NPCAgent** - Unique instance per NPC with personality and agenda
4. **CompanionAgent** - Controls autonomous team member behavior

All agents maintain conversation memory for consistent interactions.

## üì¶ Project Structure

```
src/main/java/com/airpg/
‚îú‚îÄ‚îÄ agents/              # LangChain4j AI agents
‚îÇ   ‚îú‚îÄ‚îÄ memory/         # In-memory conversation storage
‚îÇ   ‚îú‚îÄ‚îÄ AIProviderFactory.java
‚îÇ   ‚îú‚îÄ‚îÄ AgentService.java
‚îÇ   ‚îî‚îÄ‚îÄ [Agent interfaces]
‚îú‚îÄ‚îÄ config/             # Configuration mappings
‚îú‚îÄ‚îÄ domain/             # Game entities (Hero, NPC, Quest, etc.)
‚îú‚îÄ‚îÄ services/           # Game logic services
‚îÇ   ‚îú‚îÄ‚îÄ GameEngine.java
‚îÇ   ‚îú‚îÄ‚îÄ WorldService.java
‚îÇ   ‚îú‚îÄ‚îÄ NPCService.java
‚îÇ   ‚îú‚îÄ‚îÄ TeamService.java
‚îÇ   ‚îî‚îÄ‚îÄ CombatService.java
‚îî‚îÄ‚îÄ ui/                 # Vaadin UI components
    ‚îî‚îÄ‚îÄ GameView.java
```

## üöÄ Getting Started

### Prerequisites

- **Java 21** or higher
- **Maven 3.8+**
- **Node.js** (for Vaadin frontend build)
- **OpenAI API key** OR **Ollama** installed locally
- **Docker** (optional, for running Ollama via Docker Compose)

### Configuration

1. **Copy and edit** `src/main/resources/application.properties`:

For OpenAI:
```properties
ai.provider=openai
ai.openai.api-key=sk-your-api-key-here
ai.openai.model=gpt-4o
```

For Ollama (local):
```properties
ai.provider=ollama
ai.ollama.base-url=http://localhost:11434
ai.ollama.model=llama3.2
```

### Running Ollama with Docker Compose

The easiest way to run Ollama locally is using Docker Compose:

```bash
# Start Ollama container (will automatically pull llama3.2 model)
docker compose up -d

# Check if the model is ready (first run downloads ~2GB, may take several minutes)
docker compose logs -f ollama-pull

# Stop Ollama
docker compose down
```

**Note:** The first startup downloads the llama3.2 model (~2GB). This may take several minutes depending on your internet connection. Monitor progress with `docker compose logs -f ollama-pull`.

**GPU Support (NVIDIA):** Edit `docker-compose.yml` and uncomment the GPU configuration section.

2. **Set environment variable** (recommended for OpenAI):
```bash
export OPENAI_API_KEY=sk-your-api-key-here
```

### Quick Start (Pre-built Binaries)

**Download the latest release for your platform:**
1. Go to [Releases](../../releases/latest)
2. Download the archive for your operating system:
   - **Windows**: `ai-rpg-vibe-windows.zip`
   - **Linux**: `ai-rpg-vibe-linux.tar.gz`
   - **macOS**: `ai-rpg-vibe-macos.tar.gz`
3. Extract the archive
4. Run the startup script:
   - **Windows**: Double-click `run.bat` or run from command line
   - **Linux/macOS**: Run `./run.sh` in terminal
5. Open your browser to **http://localhost:8080**

**Requirements:** Java 21 or higher must be installed on your system.

### Build and Run from Source

```bash
# Development mode with live reload
mvn quarkus:dev

# Production build (creates uber-jar)
mvn clean package -Puber-jar
java -jar target/*-runner.jar
```

The application will start at: **http://localhost:8080**

## üéØ How to Play

### Starting a New Game

1. Click **"New Game"** button
2. A random main quest is selected from:
   - Slay the Dragon of Mount Doom
   - Rescue Princess Elena
   - Stop the Necromancer's Ritual
   - Find the Lost Artifact

### Commands

**General Commands:**
- `help` - Show available commands
- `stats` - View hero statistics
- `quests` - View active quests
- `team` - View party members
- `location` - Describe current location
- `talk [message]` - Converse with NPCs

**Combat Commands:**
- `attack` - Execute combat round
- `flee` - Escape from combat

**Natural Language Actions:**
- Type any action: "explore the forest", "search for treasure", "rest at the inn"
- The AI will interpret and respond contextually

### Game Mechanics

#### Character Attributes (D&D-inspired)

- **Strength** - Melee damage
- **Intelligence** - Magic damage, mana pool
- **Agility** - Defense, initiative
- **Constitution** - Health pool
- **Charisma** - NPC interactions

**Derived Stats:**
- Health = Constitution √ó 10
- Mana = Intelligence √ó 5
- Defense = 10 + Agility modifier + armor

#### Combat System

**Turn-based with dice rolls:**
- Melee hit: d20 + STR modifier vs target defense
- Melee damage: STR modifier + weapon bonus + d6
- Magic damage: INT modifier + spell power + d8
- Initiative: d20 + AGI modifier

**Autonomous Companions:**
- Decide their own actions (attack, heal, defend)
- Based on combat situation and personality
- No player micromanagement needed

## üß™ Example Gameplay

```
> New Game Started
You are Adventurer, a Warrior.
Quest: Slay the Dragon of Mount Doom

The morning sun illuminates the Village Square.
An old sage approaches you with urgent news...

> talk to sage
Old Sage Marcus: "Ah, brave warrior! The dragon grows stronger 
each day. You'll need allies for this quest."

> stats
=== Adventurer (Level 1 Warrior) ===
Health: 140/140
Mana: 50/50
Attributes:
- Strength: 16 (modifier: +3)
- Intelligence: 10 (modifier: +0)
...

> combat test
Combat begins!
A Goblin Scout emerges from the shadows, weapon drawn!

> attack
--- Turn 1 ---
Adventurer swings their blade at Goblin Scout!
Roll: 16 + 3 = 19 vs Defense 12 - HIT!
Damage: 8 HP
...
```

## üîß Development

### Adding New AI Providers

Extend `AIProviderFactory` to support additional LLM providers:

```java
private ChatLanguageModel createCustomProvider() {
    // Implementation
}
```

### Extending Game Content

- **New NPCs**: Use `NPCService.createSampleNPC()` as template
- **Custom Quests**: Extend `Quest` class and quest generation logic
- **New Locations**: Add to world generation in `WorldService`

### Memory Storage

Currently uses in-memory storage (`InMemoryChatMemoryStore`).

**Future: JOOQ Integration**
- Implement persistent storage for NPC memories
- Store conversation histories in database
- Enable save/load game functionality

## üìù Configuration Reference

### Game Settings

```properties
# Maximum team size (companions)
game.max-team-size=4

# Available main quest goals (comma-separated)
game.initial-goals=Slay the Dragon of Mount Doom,Rescue Princess Elena,...
```

### AI Provider Settings

**OpenAI:**
```properties
ai.openai.model=gpt-4o          # Model name
ai.openai.temperature=0.8        # Creativity (0.0-2.0)
ai.openai.max-tokens=1000        # Response length
```

**Ollama:**
```properties
ai.ollama.base-url=http://localhost:11434
ai.ollama.model=llama3.2
ai.ollama.temperature=0.8
```

## üêõ Troubleshooting

**Issue**: "No AI provider configured"
- **Solution**: Set `ai.provider` and corresponding API keys

**Issue**: Vaadin frontend build fails
- **Solution**: Ensure Node.js is installed, run `mvn clean install`

**Issue**: Ollama connection refused
- **Solution**: Start Ollama service: `ollama serve`

**Issue**: High AI response latency
- **Solution**: Reduce `max-tokens` or use faster model (e.g., gpt-3.5-turbo)

## üìö Further Development

### Planned Features

- [ ] Persistent game saves (JOOQ integration)
- [ ] Inventory and item system
- [ ] Character equipment and leveling trees
- [ ] Multiple biomes and procedural dungeons
- [ ] Multiplayer support
- [ ] Voice synthesis for narration
- [ ] Image generation for locations

### Contributing

This is a demonstration project showcasing AI-driven game development with Quarkus and Vaadin.

### Creating Releases

The project uses GitHub Actions to automatically build and release executables for Windows, Linux, and macOS.

**To create a new release:**
1. Tag your commit with a version number:
   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```
2. GitHub Actions will automatically:
   - Build the application for all platforms
   - Create platform-specific packages
   - Create a GitHub release with downloadable artifacts

**Manual workflow trigger:**
You can also manually trigger the build workflow from the GitHub Actions tab without creating a tag. This is useful for testing the build process.

## üìÑ License

This project is provided as-is for educational and demonstration purposes.

## üôè Credits

- **Quarkus** - Supersonic Subatomic Java
- **Vaadin** - Full-stack web framework
- **LangChain4j** - Java framework for LLM applications
- **OpenAI** / **Ollama** - AI model providers

---

**Enjoy your AI-powered fantasy adventure!** üêâ‚öîÔ∏èüõ°Ô∏è
